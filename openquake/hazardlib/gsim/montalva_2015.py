# The Hazard Library
# Copyright (C) 2015 GEM Foundation
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as
# published by the Free Software Foundation, either version 3 of the
# License, or (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Affero General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
"""
Module exports :class:`MontalvaEtAl2015SInter`
               :class:`MontalvaEtAl2015SSlab`
"""

from __future__ import division

import numpy as np

from openquake.hazardlib.gsim.base import GMPE, CoeffsTable
from openquake.hazardlib import const
from openquake.hazardlib.imt import PGA, SA
from openquake.hazardlib.gsim.abrahamson_2015 import (AbrahamsonEtAl2015SInter,
                                                      AbrahamsonEtAl2015SSlab)


class MontalvaEtAl2015SInter(AbrahamsonEtAl2015SInter):
    """
    Adaptation of the Abrahamson et al. (2015) BC Hydro subduction interface
    GMPE, calibrated to Chilean strong motion data
    """

    def _compute_magnitude_term(self, C, dc1, mag):
        """
        Computes the magnitude scaling term given by equation (2)
        corrected by a local adjustment factor
        """
        base = C['theta1'] - C["corr1_th1"] + (self.CONSTS['theta4'] * dc1)
        dmag = self.CONSTS["C1"] + dc1
        if mag > dmag:
            f_mag = (self.CONSTS['theta5'] * (mag - dmag)) +\
                C['theta13'] * ((10. - mag) ** 2.)

        else:
            f_mag = (self.CONSTS['theta4'] * (mag - dmag)) +\
                C['theta13'] * ((10. - mag) ** 2.)

        return base + f_mag

    COEFFS = CoeffsTable(sa_damping=5, table="""\
    imt       vlin       b   theta1  theta2    theta6   theta7  theta8  theta10   theta11   theta12   theta13  theta14  theta15  theta16      corr1_th1           phi           tau         sigma  sigma_ss
    pga      865.1  -1.186   4.2203   -1.35   -0.0012   1.0988   -1.42     3.12    0.0130    0.9800   -0.0135    -0.40   0.9969    -1.00   -0.909071616   0.573935198   0.564097911   0.804740992       0.6
    0.020    865.1  -1.186   4.2203   -1.35   -0.0012   1.0988   -1.42     3.12    0.0130    0.9800   -0.0135    -0.40   0.9969    -1.00   -0.926310661   0.586080898   0.566556631   0.815154731       0.6
    0.050   1053.5  -1.346   4.5371   -1.40   -0.0012   1.2536   -1.65     3.37    0.0130    1.2880   -0.0138    -0.40   1.1030    -1.18   -1.093380905   0.600151382   0.635697605   0.874238598       0.6
    0.075   1085.7  -1.471   5.0733   -1.45   -0.0012   1.4175   -1.80     3.37    0.0130    1.4830   -0.0142    -0.40   1.2732    -1.36   -1.066365277   0.619461181   0.625751043   0.880509240       0.6
    0.100   1032.5  -1.624   5.2892   -1.45   -0.0012   1.3997   -1.80     3.33    0.0130    1.6130   -0.0145    -0.40   1.3042    -1.36   -1.003185441   0.649624661   0.572820703   0.866103780       0.6
    0.150    877.6  -1.931   5.4563   -1.45   -0.0014   1.3582   -1.69     3.25    0.0130    1.8820   -0.0153    -0.40   1.2600    -1.30   -0.958041849   0.683143963   0.557568810   0.881798532       0.6
    0.200    748.2  -2.188   5.2684   -1.40   -0.0018   1.1648   -1.49     3.03    0.0129    2.0760   -0.0162    -0.35   1.2230    -1.25   -0.901481071   0.670365218   0.576301208   0.884032017       0.6
    0.250    654.3  -2.381   5.0594   -1.35   -0.0023   0.9940   -1.30     2.80    0.0129    2.2480   -0.0172    -0.31   1.1600    -1.17   -0.903656899   0.638830573   0.602621593   0.878212551       0.6
    0.300    587.1  -2.518   4.7945   -1.28   -0.0027   0.8821   -1.18     2.59    0.0128    2.3480   -0.0183    -0.28   1.0500    -1.06   -0.856612654   0.625650692   0.636363655   0.892411054       0.6
    0.400    503.0  -2.657   4.4644   -1.18   -0.0035   0.7046   -0.98     2.20    0.0127    2.4270   -0.0206    -0.23   0.8000    -0.78   -0.682812070   0.637175217   0.653868649   0.912982183       0.6
    0.500    456.6  -2.669   4.0181   -1.08   -0.0044   0.5799   -0.82     1.92    0.0125    2.3990   -0.0231    -0.19   0.6620    -0.62   -0.604200149   0.610647692   0.665334969   0.903084284       0.6
    0.600    430.3  -2.599   3.6055   -0.99   -0.0050   0.5021   -0.70     1.70    0.0124    2.2730   -0.0256    -0.16   0.5800    -0.50   -0.486602703   0.585483966   0.659310336   0.881749167       0.6
    0.750    410.5  -2.401   3.2174   -0.91   -0.0058   0.3687   -0.54     1.42    0.0120    1.9930   -0.0296    -0.12   0.4800    -0.34   -0.369153323   0.615785485   0.654226904   0.898445661       0.6
    1.000    400.0  -1.955   2.7981   -0.85   -0.0062   0.1746   -0.34     1.10    0.0114    1.4700   -0.0363    -0.07   0.3300    -0.14   -0.202012613   0.615243231   0.662675947   0.904247557       0.6
    1.500    400.0  -1.025   2.0123   -0.77   -0.0064  -0.0820   -0.05     0.70    0.0100    0.4080   -0.0493     0.00   0.3100     0.00   -0.133987013   0.574729236   0.679594005   0.890034666       0.6
    2.000    400.0  -0.299   1.4128   -0.71   -0.0064  -0.2821    0.12     0.70    0.0085   -0.4010   -0.0610     0.00   0.3000     0.00   -0.122225278   0.559512956   0.662257380   0.866971502       0.6
    2.500    400.0   0.000   0.9976   -0.67   -0.0064  -0.4108    0.25     0.70    0.0069   -0.7230   -0.0711     0.00   0.3000     0.00   -0.138614754   0.557225885   0.646680832   0.853637385       0.6
    3.000    400.0   0.000   0.6443   -0.64   -0.0064  -0.4466    0.30     0.70    0.0054   -0.6730   -0.0798     0.00   0.3000     0.00   -0.196007564   0.520921286   0.628062649   0.815978969       0.6
    4.000    400.0   0.000   0.0657   -0.58   -0.0064  -0.4344    0.30     0.70    0.0027   -0.6270   -0.0935     0.00   0.3000     0.00   -0.262577721   0.517410083   0.612876291   0.802078888       0.6
    5.000    400.0   0.000  -0.4624   -0.54   -0.0064  -0.4368    0.30     0.70    0.0005   -0.5960   -0.0980     0.00   0.3000     0.00   -0.322685508   0.521664035   0.602750403   0.797145792       0.6
    6.000    400.0   0.000  -0.9809   -0.50   -0.0064  -0.4586    0.30     0.70   -0.0013   -0.5660   -0.0980     0.00   0.3000     0.00   -0.330981121   0.507772028   0.572173888   0.764993719       0.6
    7.500    400.0   0.000  -1.6017   -0.46   -0.0064  -0.4433    0.30     0.70   -0.0033   -0.5280   -0.0980     0.00   0.3000     0.00   -0.431844003   0.521719924   0.582622878   0.782074866       0.6
    10.00    400.0   0.000  -2.2937   -0.40   -0.0064  -0.4828    0.30     0.70   -0.0060   -0.5040   -0.0980     0.00   0.3000     0.00   -0.422154538   0.485173091   0.573742463   0.751380957       0.6
    """)


class MontalvaEtAl2015SSlab(AbrahamsonEtAl2015SSlab):
    """
    Adaptation of the Abrahamson et al. (2015) BC Hydro subduction in-slab
    GMPE, calibrated to Chilean strong motion data
    """
    def _compute_magnitude_term(self, C, dc1, mag):
        """
        Computes the magnitude scaling term given by equation (2)
        corrected by a local adjustment factor
        """
        base = C['theta1'] - C["corr1_th1"] + (self.CONSTS['theta4'] * dc1)
        dmag = self.CONSTS["C1"] + dc1
        if mag > dmag:
            f_mag = (self.CONSTS['theta5'] * (mag - dmag)) +\
                C['theta13'] * ((10. - mag) ** 2.)

        else:
            f_mag = (self.CONSTS['theta4'] * (mag - dmag)) +\
                C['theta13'] * ((10. - mag) ** 2.)

        return base + f_mag

    COEFFS = CoeffsTable(sa_damping=5, table="""\
    imt       vlin       b   theta1  theta2    theta6   theta7  theta8  theta10   theta11   theta12   theta13  theta14  theta15  theta16      corr1_th1           phi           tau         sigma  sigma_ss
    pga      865.1  -1.186   4.2203   -1.35   -0.0012   1.0988   -1.42     3.12    0.0130    0.9800   -0.0135    -0.40   0.9969    -1.00   -0.909071616   0.573935198   0.564097911   0.804740992       0.6
    0.020    865.1  -1.186   4.2203   -1.35   -0.0012   1.0988   -1.42     3.12    0.0130    0.9800   -0.0135    -0.40   0.9969    -1.00   -0.926310661   0.586080898   0.566556631   0.815154731       0.6
    0.050   1053.5  -1.346   4.5371   -1.40   -0.0012   1.2536   -1.65     3.37    0.0130    1.2880   -0.0138    -0.40   1.1030    -1.18   -1.093380905   0.600151382   0.635697605   0.874238598       0.6
    0.075   1085.7  -1.471   5.0733   -1.45   -0.0012   1.4175   -1.80     3.37    0.0130    1.4830   -0.0142    -0.40   1.2732    -1.36   -1.066365277   0.619461181   0.625751043   0.880509240       0.6
    0.100   1032.5  -1.624   5.2892   -1.45   -0.0012   1.3997   -1.80     3.33    0.0130    1.6130   -0.0145    -0.40   1.3042    -1.36   -1.003185441   0.649624661   0.572820703   0.866103780       0.6
    0.150    877.6  -1.931   5.4563   -1.45   -0.0014   1.3582   -1.69     3.25    0.0130    1.8820   -0.0153    -0.40   1.2600    -1.30   -0.958041849   0.683143963   0.557568810   0.881798532       0.6
    0.200    748.2  -2.188   5.2684   -1.40   -0.0018   1.1648   -1.49     3.03    0.0129    2.0760   -0.0162    -0.35   1.2230    -1.25   -0.901481071   0.670365218   0.576301208   0.884032017       0.6
    0.250    654.3  -2.381   5.0594   -1.35   -0.0023   0.9940   -1.30     2.80    0.0129    2.2480   -0.0172    -0.31   1.1600    -1.17   -0.903656899   0.638830573   0.602621593   0.878212551       0.6
    0.300    587.1  -2.518   4.7945   -1.28   -0.0027   0.8821   -1.18     2.59    0.0128    2.3480   -0.0183    -0.28   1.0500    -1.06   -0.856612654   0.625650692   0.636363655   0.892411054       0.6
    0.400    503.0  -2.657   4.4644   -1.18   -0.0035   0.7046   -0.98     2.20    0.0127    2.4270   -0.0206    -0.23   0.8000    -0.78   -0.682812070   0.637175217   0.653868649   0.912982183       0.6
    0.500    456.6  -2.669   4.0181   -1.08   -0.0044   0.5799   -0.82     1.92    0.0125    2.3990   -0.0231    -0.19   0.6620    -0.62   -0.604200149   0.610647692   0.665334969   0.903084284       0.6
    0.600    430.3  -2.599   3.6055   -0.99   -0.0050   0.5021   -0.70     1.70    0.0124    2.2730   -0.0256    -0.16   0.5800    -0.50   -0.486602703   0.585483966   0.659310336   0.881749167       0.6
    0.750    410.5  -2.401   3.2174   -0.91   -0.0058   0.3687   -0.54     1.42    0.0120    1.9930   -0.0296    -0.12   0.4800    -0.34   -0.369153323   0.615785485   0.654226904   0.898445661       0.6
    1.000    400.0  -1.955   2.7981   -0.85   -0.0062   0.1746   -0.34     1.10    0.0114    1.4700   -0.0363    -0.07   0.3300    -0.14   -0.202012613   0.615243231   0.662675947   0.904247557       0.6
    1.500    400.0  -1.025   2.0123   -0.77   -0.0064  -0.0820   -0.05     0.70    0.0100    0.4080   -0.0493     0.00   0.3100     0.00   -0.133987013   0.574729236   0.679594005   0.890034666       0.6
    2.000    400.0  -0.299   1.4128   -0.71   -0.0064  -0.2821    0.12     0.70    0.0085   -0.4010   -0.0610     0.00   0.3000     0.00   -0.122225278   0.559512956   0.662257380   0.866971502       0.6
    2.500    400.0   0.000   0.9976   -0.67   -0.0064  -0.4108    0.25     0.70    0.0069   -0.7230   -0.0711     0.00   0.3000     0.00   -0.138614754   0.557225885   0.646680832   0.853637385       0.6
    3.000    400.0   0.000   0.6443   -0.64   -0.0064  -0.4466    0.30     0.70    0.0054   -0.6730   -0.0798     0.00   0.3000     0.00   -0.196007564   0.520921286   0.628062649   0.815978969       0.6
    4.000    400.0   0.000   0.0657   -0.58   -0.0064  -0.4344    0.30     0.70    0.0027   -0.6270   -0.0935     0.00   0.3000     0.00   -0.262577721   0.517410083   0.612876291   0.802078888       0.6
    5.000    400.0   0.000  -0.4624   -0.54   -0.0064  -0.4368    0.30     0.70    0.0005   -0.5960   -0.0980     0.00   0.3000     0.00   -0.322685508   0.521664035   0.602750403   0.797145792       0.6
    6.000    400.0   0.000  -0.9809   -0.50   -0.0064  -0.4586    0.30     0.70   -0.0013   -0.5660   -0.0980     0.00   0.3000     0.00   -0.330981121   0.507772028   0.572173888   0.764993719       0.6
    7.500    400.0   0.000  -1.6017   -0.46   -0.0064  -0.4433    0.30     0.70   -0.0033   -0.5280   -0.0980     0.00   0.3000     0.00   -0.431844003   0.521719924   0.582622878   0.782074866       0.6
    10.00    400.0   0.000  -2.2937   -0.40   -0.0064  -0.4828    0.30     0.70   -0.0060   -0.5040   -0.0980     0.00   0.3000     0.00   -0.422154538   0.485173091   0.573742463   0.751380957       0.6
        """)
